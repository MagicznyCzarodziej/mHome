# Migration `20201020205754-basic`

This migration has been generated by Przemys≈Çaw Pitus at 10/20/2020, 10:57:54 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "Group" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "description" TEXT,
    "icon" TEXT,
PRIMARY KEY ("id")
)

CREATE TABLE "Light" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "description" TEXT,
    "state" TEXT NOT NULL DEFAULT 'OFF',
    "groupId" TEXT,
    "updatedAt" DATETIME NOT NULL,

    FOREIGN KEY ("groupId") REFERENCES "Group"("id") ON DELETE SET NULL ON UPDATE CASCADE,
PRIMARY KEY ("id")
)

CREATE TABLE "Thermometer" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "description" TEXT,
    "latestTemperature" REAL NOT NULL,
    "groupId" TEXT,

    FOREIGN KEY ("groupId") REFERENCES "Group"("id") ON DELETE SET NULL ON UPDATE CASCADE,
PRIMARY KEY ("id")
)

CREATE TABLE "Blinds" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "description" TEXT,
    "state" INTEGER NOT NULL,
    "groupId" TEXT,
    "updatedAt" DATETIME NOT NULL,

    FOREIGN KEY ("groupId") REFERENCES "Group"("id") ON DELETE SET NULL ON UPDATE CASCADE,
PRIMARY KEY ("id")
)

CREATE TABLE "Reed" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "description" TEXT,
    "state" INTEGER NOT NULL,
    "groupId" TEXT,
    "updatedAt" DATETIME NOT NULL,

    FOREIGN KEY ("groupId") REFERENCES "Group"("id") ON DELETE SET NULL ON UPDATE CASCADE,
PRIMARY KEY ("id")
)

CREATE TABLE "Temperature" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "value" REAL NOT NULL,
    "datetime" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "thermometerId" TEXT NOT NULL,

    FOREIGN KEY ("thermometerId") REFERENCES "Thermometer"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "Connection" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "ip" TEXT NOT NULL,
    "client" TEXT NOT NULL,
    "connectedAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "disconnectedAt" DATETIME
)
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201020205754-basic
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,84 @@
+datasource db {
+  provider = "sqlite"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+//
+
+model Group {
+  id           String        @id
+  name         String
+  description  String?
+  icon         String?
+  lights       Light[]
+  thermometers Thermometer[]
+  blinds       Blinds[]
+  reeds        Reed[]
+}
+
+// Elements
+
+model Light {
+  id          String   @id
+  name        String
+  description String?
+  state       String   @default("OFF") /// ON or OFF
+  group       Group?   @relation(fields: [groupId], references: [id])
+  groupId     String?
+  updatedAt   DateTime @updatedAt
+}
+
+model Thermometer {
+  id                String        @id
+  name              String
+  description       String?
+  latestTemperature Float
+  temperatures      Temperature[]
+  group             Group?        @relation(fields: [groupId], references: [id])
+  groupId           String?
+}
+
+model Blinds {
+  id          String   @id
+  name        String
+  description String?
+  state       Int /// 0-100 where 0 is fully closed and 100 is fully open
+  group       Group?   @relation(fields: [groupId], references: [id])
+  groupId     String?
+  updatedAt   DateTime @updatedAt
+}
+
+model Reed {
+  id          String   @id
+  name        String
+  description String?
+  state       Int /// 0-100 where 0 is fully closed and 100 is fully open
+  group       Group?   @relation(fields: [groupId], references: [id])
+  groupId     String?
+  updatedAt   DateTime @updatedAt
+}
+
+//
+
+model Temperature {
+  id            Int         @id @default(autoincrement())
+  value         Float
+  datetime      DateTime    @default(now())
+  thermometer   Thermometer @relation(fields: [thermometerId], references: [id])
+  thermometerId String
+}
+
+//
+
+/// Log every client connection
+model Connection {
+  id             Int       @id
+  ip             String
+  client         String
+  connectedAt    DateTime  @default(now())
+  disconnectedAt DateTime?
+}
```


